# Odoo配置

## 一，conf文件配置

### 准备工作
创建data目录
```sh
(venv) odoo@$ cd /home/odoo/odoo10
(venv) odoo@$ mkdir data
```
创建日志目录
```sh
# mkdir /var/log/odoo
# chown -R odoo:odoo /var/log/odoo
```
增加workers
```sh
(venv) odoo@$ python
>>>import multiprocessing
>>>multiprocessing.cpu_count()
>>>2
```
>  获得cpu个数+1 为workers个数，更多请看本站 odoo性能调优介绍

建立模块目录
```sh
(venv) odoo@$ mkdir /home/odoo/odoo10/custom-addons
```

### 编写配置文件
```sh
(venv) odoo@$ vim /home/odoo/odoo10/odoo10.conf
```

### conf文件内容
```sh
[options]
db_template = template0
db_host = 127.0.0.1
db_port = 5432
db_name = odoo10
db_user = odoo
db_password = odoodb***1
admin_passwd = odooweb***1
xmlrpc_port = 8069
data_dir = /home/odoo/odoo10/data
log_level = warn
logfile = /var/log/odoo/odoo10.log
workers = 3
addons_path = /home/odoo/odoo10/custom-addons,/home/odoo/odoo10/addons
```
内容详解
1. admin_passwd 启用web数据库管理密码 admin_passwd（不能设置为admin，无效密码）
2. xmlrpc_interface 监听IP段改为本地（127.0.0.1）, 可实现禁止外网直接访问odoo（默认0.0.0.0）
   外网包括局域网，所以只能去掉xmlrpc_interface = 127.0.0.1
3. xmlrpc_port 监听端口（默认8069）
4. 注意db_user 和db_password 和之前设置的数据库里的用户名一致
5. 可选项
   	* log_level = info
   	* log_level = debug
   	* log_level = warn
   The following log levels can be particularly interesting:
   	* debug_sql to inspect SQL queries generated by the server
   	* debug_rpc to detail the requests received by the server
   	* debug_rpc_answer to detail the responses sent by the server
6. logfile
   By default, the log output is directed to standard output (your console screen), but it can be directed to a log file with the --logfile=<filepath> option.

7. 如果odoo是以nightly包的形式安装的，则核心模块和业务模块都放在一个目录里
/home/odoo/odoo10/venv/lib/python2.7/site-packages/odoo-10.0.post20170408-py2.7.egg/odoo/addons
可以不配置addons_path参数

### 手动启动服务器
```sh
# su odoo
$ source venv/bin/activate
(venv) odoo@$ chmod 755 odoo-bin
(venv) odoo@$ ./odoo-bin -c odoo10.conf
```

浏览器访问 http://Server_IP:8069

## 二，配置开机启动脚本

使用systemd模式，如不了解请看FAQ。
```sh
# vim /etc/systemd/system/odoo10.service
```
配置内容
```sh
[Unit]
Description=Odoo10
Requires=postgresql.service
After=postgresql.service
[Service]
Type=simple
PermissionsStartOnly=true
User=odoo
Group=odoo
SyslogIdentifier=odoo10
ExecStart=/home/odoo/odoo10/venv/bin/python /home/odoo/odoo10/odoo-bin -c /home/odoo/odoo10/odoo10.conf
[Install]
WantedBy=default.target
```
运行
```sh
# systemctl enable odoo10.service
# systemctl start odoo10.service
```
这样配置之后，ubuntu重启了，odoo服务自动启动（nginx和postgresql的自启动服务系统已经帮我们添加好了）

使用systemctl status odoo10.service 可以了解当前服务的状态。
```sh
# ps -ef
# systemctl status odoo10.service
```
停止服务
```sh
# systemctl stop odoo10.service
```

之后更新odoo10.service,需通过systemctl daemon-reload和systemctl restart odoo10.service重启odoo进程，
```sh
# systemctl restart odoo10.service
```



[back](./)
